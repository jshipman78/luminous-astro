---
import { getCollection, render } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import CTASection from '../../components/sections/CTASection.astro';
import ServiceCard from '../../components/sections/ServiceCard.astro';
import siteConfig from '../../data/siteConfig.json';

export async function getStaticPaths() {
  const cities = await getCollection('cities');
  return cities.map((city) => ({
    params: { slug: city.data.slug },
    props: { city },
  }));
}

const { city } = Astro.props;
const { Content } = await render(city);
const { business, serviceAreas } = siteConfig;

// Get other service areas for the "nearby" section
const otherAreas = serviceAreas.filter(area => area.slug !== city.data.slug);

// Services to highlight
const services = [
  {
    title: "Real Estate Photography",
    description: `Professional listing photos for ${city.data.city} realtors. HDR photography, twilight shots, and fast turnaround.`,
    href: "/real-estate-photography",
    icon: "home" as const,
    featured: true,
  },
  {
    title: "Matterport 3D Tours",
    description: `Virtual tours that let buyers explore ${city.data.city} properties from anywhere in the world.`,
    href: "/matterport-3d-tours",
    icon: "cube" as const,
  },
  {
    title: "Aerial Drone Photography",
    description: `FAA-certified aerial photography showcasing ${city.data.city} properties and land from above.`,
    href: "/aerial-drone-photography",
    icon: "plane" as const,
  },
  {
    title: "Portrait Photography",
    description: `Family portraits, senior photos, and headshots for ${city.data.city} families and professionals.`,
    href: "/portrait-photography",
    icon: "users" as const,
  },
];

// Schema markup for local service
const localSchema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": `${business.name} - ${city.data.city}`,
  "description": city.data.metaDescription,
  "telephone": business.phoneRaw,
  "url": `https://luminouspro.com/service-areas/${city.data.slug}`,
  "areaServed": {
    "@type": "City",
    "name": city.data.city,
    "containedInPlace": {
      "@type": "State",
      "name": city.data.state
    }
  },
  "parentOrganization": {
    "@type": "Organization",
    "@id": "https://luminouspro.com/#organization"
  }
};
---

<BaseLayout
  title={city.data.metaTitle}
  description={city.data.metaDescription}
>
  <script type="application/ld+json" set:html={JSON.stringify(localSchema)} slot="head" />

  <!-- Hero Section -->
  <section class="relative py-24 md:py-32 bg-primary overflow-hidden">
    <div class="container relative z-10">
      <div class="max-w-3xl">
        <div class="flex items-center gap-2 mb-4">
          <svg class="w-5 h-5 text-accent" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
          </svg>
          <p class="text-accent font-semibold uppercase tracking-wide text-sm">
            {city.data.city}, {city.data.state}
            {city.data.isHomeBase && <span class="ml-2 text-white/60">(Our Home Base)</span>}
          </p>
        </div>
        <h1 class="font-display text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-6">
          {city.data.heroHeadline}
        </h1>
        <p class="text-xl text-white/90 leading-relaxed mb-8">
          {city.data.heroDescription}
        </p>
        <div class="flex flex-wrap gap-4">
          <a href={business.bookingPortal} target="_blank" rel="noopener noreferrer" class="btn btn-primary text-lg px-8 py-4">
            Book a Session
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </a>
          <a href={`tel:${business.phoneRaw}`} class="btn btn-outline-white text-lg px-8 py-4">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
            </svg>
            {business.phone}
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Services Section -->
  <section class="section bg-light-bg">
    <div class="container">
      <div class="text-center mb-12">
        <p class="text-accent font-semibold uppercase tracking-wide text-sm mb-3">
          Our Services
        </p>
        <h2 class="font-display text-3xl md:text-4xl font-bold text-primary mb-4">
          Photography Services in {city.data.city}
        </h2>
        <p class="text-muted text-lg max-w-2xl mx-auto">
          Professional photography and digital services available throughout {city.data.city} and surrounding areas.
        </p>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
        {services.map((service) => (
          <ServiceCard {...service} />
        ))}
      </div>
    </div>
  </section>

  <!-- Content Section -->
  <section class="section">
    <div class="container">
      <div class="max-w-3xl mx-auto">
        <div class="prose prose-lg prose-primary max-w-none">
          <Content />
        </div>
      </div>
    </div>
  </section>

  <!-- Local Landmarks (if available) -->
  {city.data.localLandmarks && city.data.localLandmarks.length > 0 && (
    <section class="section bg-light-bg">
      <div class="container">
        <div class="text-center mb-12">
          <p class="text-accent font-semibold uppercase tracking-wide text-sm mb-3">
            Local Expertise
          </p>
          <h2 class="font-display text-3xl md:text-4xl font-bold text-primary mb-4">
            We Know {city.data.city}
          </h2>
          <p class="text-muted text-lg max-w-2xl mx-auto">
            From iconic landmarks to hidden gems, we know the best locations for your shoot.
          </p>
        </div>

        <div class="flex flex-wrap justify-center gap-4">
          {city.data.localLandmarks.map((landmark: string) => (
            <div class="bg-white px-6 py-3 rounded-full shadow-sm border border-border">
              <span class="text-primary font-medium">{landmark}</span>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Nearby Areas -->
  <section class="section">
    <div class="container">
      <div class="text-center mb-12">
        <p class="text-accent font-semibold uppercase tracking-wide text-sm mb-3">
          We Also Serve
        </p>
        <h2 class="font-display text-3xl md:text-4xl font-bold text-primary mb-4">
          Nearby Service Areas
        </h2>
        <p class="text-muted text-lg max-w-2xl mx-auto">
          Based in Commerce, we serve clients throughout Northeast Texas.
        </p>
      </div>

      <div class="flex flex-wrap justify-center gap-4">
        {otherAreas.map((area) => (
          <a
            href={`/service-areas/${area.slug}`}
            class:list={[
              "px-6 py-3 rounded-full font-medium transition-all hover:-translate-y-1",
              area.isHomeBase
                ? "bg-accent text-white"
                : "bg-light-bg text-primary hover:bg-accent hover:text-white"
            ]}
          >
            {area.city}, {area.state}
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <CTASection
    headline={`Ready to book in ${city.data.city}?`}
    description={`Contact us today to schedule your photography session in ${city.data.city}. Same-day appointments often available.`}
    variant="dark"
  />
</BaseLayout>
